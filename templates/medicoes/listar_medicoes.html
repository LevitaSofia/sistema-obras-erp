{% extends "base.html" %}

{% block title %}Medições - {{ obra.nome }}{% endblock %}

{% block head %}
{{ super() }}
<link rel="stylesheet" href="{{ url_for('static', filename='faturamento.css') }}">
{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="faturamento-panel">
        <h2>Medições Realizadas</h2>
        <p><strong>Obra:</strong> {{ obra.nome }}</p>
        <p><strong>Construtora:</strong> {{ obra.construtora_nome }}</p>
    </div>

    <div class="d-flex justify-content-between align-items-center mb-3">
        <a href="{{ url_for('visualizar_obra', id=obra.id) }}" class="btn btn-secondary">
            <i class="bi bi-arrow-left"></i> Voltar para a Obra
        </a>
        <a href="{{ url_for('nova_medicao', obra_id=obra.id) }}" class="btn btn-success">
            <i class="bi bi-plus-circle"></i> Registrar Nova Medição
        </a>
    </div>

    <div class="card">
        <div class="card-body">
            <h5 class="card-title">Histórico de Medições</h5>
            {% if medicoes %}
            <table class="table table-striped table-hover table-medicoes">
                <thead>
                    <tr>
                        <th scope="col">Data</th>
                        <th scope="col">Nota Fiscal</th>
                        <th scope="col" class="text-end">Valor (R$)</th>
                    </tr>
                </thead>
                <tbody>
                    {% for medicao in medicoes %}
                    <tr>
                        <td>{{ medicao.data | format_date }}</td>
                        <td>{{ medicao.nota_fiscal or 'N/A' }}</td>
                        <td class="text-end">{{ "%.2f"|format(medicao.valor) }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
                <tfoot>
                    <tr class="table-group-divider">
                        <td colspan="2" class="text-end fw-bold">Total</td>
                        <td class="text-end fw-bold">{{ "%.2f"|format(medicoes|sum(attribute='valor')) }}</td>
                    </tr>
                </tfoot>
            </table>
            {% else %}
            <div class="alert alert-info text-center" role="alert">
                <i class="bi bi-info-circle-fill me-2"></i>
                Nenhuma medição registrada para esta obra ainda.
            </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}